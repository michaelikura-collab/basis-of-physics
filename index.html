<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å®ŸåŠ›ãƒ†ã‚¹ãƒˆä»˜ãå˜èªå¸³</title>
    <style>
        body {
            font-family: sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
            background-color: #f0f4f8;
            color: #333;
        }

        /* é€²è¡Œåº¦ãªã©ã®æƒ…å ±è¡¨ç¤ºã‚¨ãƒªã‚¢ */
        .status-bar {
            margin-bottom: 10px;
            font-size: 18px;
            font-weight: bold;
            color: #555;
        }

        /* ã‚«ãƒ¼ãƒ‰ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        #card {
            width: 320px;
            height: 220px;
            background-color: white;
            border-radius: 15px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: bold;
            cursor: pointer;
            user-select: none;
            border: 2px solid #3b82f6;
            padding: 20px;
            text-align: center;
            margin-bottom: 20px;
            position: relative;
        }
        #card:active { transform: scale(0.98); }

        /* ãƒœã‚¿ãƒ³ã‚¨ãƒªã‚¢ */
        .button-container {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
            width: 350px;
        }
        button {
            padding: 12px 24px;
            font-size: 16px;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: opacity 0.2s;
        }
        button:hover { opacity: 0.9; }

        /* è‰²ã€…ãªãƒœã‚¿ãƒ³ã®è‰² */
        .btn-next { background-color: #3b82f6; }   /* é’ */
        .btn-test { background-color: #f59e0b; }   /* ã‚ªãƒ¬ãƒ³ã‚¸ */
        .btn-ok   { background-color: #10b981; }   /* ç·‘ */
        .btn-ng   { background-color: #ef4444; }   /* èµ¤ */
        .btn-retry{ background-color: #6366f1; }   /* ç´« */

        /* ãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿ã‚¨ãƒªã‚¢ */
        .file-upload {
            position: absolute;
            top: 20px;
            left: 20px;
            font-size: 14px;
        }

        /* éè¡¨ç¤ºã«ã™ã‚‹ãŸã‚ã®ã‚¯ãƒ©ã‚¹ */
        .hidden { display: none; }
    </style>
</head>
<body>

    <div class="file-upload">
        <input type="file" id="fileInput" accept=".csv" onchange="loadCSV(this)">
    </div>

    <div id="statusBar" class="status-bar">CSVã‚’èª­ã¿è¾¼ã‚“ã§ãã ã•ã„</div>

    <div id="card" onclick="onCardClick()">ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠã§é–‹å§‹</div>
    
    <div class="button-container">
        
        <div id="studyControls">
            <button class="btn-test" onclick="startTest()">ãƒ†ã‚¹ãƒˆã‚’å§‹ã‚ã‚‹</button>
            <button class="btn-next" onclick="nextWord()">æ¬¡ã®å˜èª</button>
        </div>

        <div id="testControls" class="hidden">
            <button class="btn-ng" onclick="answer(false)">ğŸ™…â€â™€ï¸ ã‚ã‹ã‚‰ãªã„</button>
            <button class="btn-ok" onclick="answer(true)">ğŸ™†â€â™€ï¸ ã‚ã‹ã‚‹</button>
        </div>

        <div id="resultControls" class="hidden">
            <button class="btn-retry" onclick="startTest()">ã‚‚ã†ä¸€åº¦ãƒ†ã‚¹ãƒˆ</button>
            <button class="btn-next" onclick="endTest()">å˜èªå¸³ã«æˆ»ã‚‹</button>
        </div>

    </div>

    <script>
        let wordList = [];
        let currentIndex = 0;
        let isFront = true;
        let isTestMode = false; // ãƒ†ã‚¹ãƒˆä¸­ã‹ã©ã†ã‹
        let score = 0;          // æ­£è§£æ•°

        const cardElement = document.getElementById("card");
        const statusElement = document.getElementById("statusBar");
        
        const studyControls = document.getElementById("studyControls");
        const testControls = document.getElementById("testControls");
        const resultControls = document.getElementById("resultControls");

        // --- CSVèª­ã¿è¾¼ã¿ ---
        function loadCSV(input) {
            const file = input.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = function(e) {
                const text = e.target.result;
                wordList = [];
                const lines = text.split(/\r\n|\n/);
                lines.forEach(line => {
                    const parts = line.split(',');
                    if (parts.length >= 2) {
                        wordList.push({ front: parts[0], back: parts
